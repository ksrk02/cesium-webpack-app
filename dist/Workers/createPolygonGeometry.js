define(["./when-54335d57","./Cartesian2-8646c5a1","./ArcType-2b58731c","./GeometryOffsetAttribute-718fa138","./BoundingRectangle-07202124","./Transforms-79117a7b","./Check-24483042","./ComponentDatatype-1a100acd","./EllipsoidGeodesic-cc216670","./EllipsoidTangentPlane-325a8e68","./GeometryAttribute-374f805d","./GeometryInstance-6aa9010a","./GeometryPipeline-571ff4c9","./IndexDatatype-82ceea78","./Math-d6182036","./PolygonGeometryLibrary-2a7648d9","./PolygonPipeline-97a7160d","./VertexFormat-81ec7207","./RuntimeError-88a32665","./WebGLConstants-95ceb4e9","./IntersectionTests-5394f658","./Plane-13ae4b1b","./AttributeCompression-10c27d9c","./EncodedCartesian3-bf827957","./arrayRemoveDuplicates-3fea1e5f","./EllipsoidRhumbLine-2b7999f3","./GeometryAttributes-caa08d6c"],(function(e,t,r,a,o,i,n,s,l,u,p,c,y,m,g,d,h,f,b,_,v,P,C,w,x,T,I){"use strict";var A=new t.Cartographic,E=new t.Cartographic,G=new o.BoundingRectangle,O=new t.Cartesian3,V=new t.Cartesian3,F=new t.Cartesian3,D=new t.Cartesian3,L=new t.Cartesian3,N=new t.Cartesian3,H=new t.Cartesian3,R=new t.Cartesian3,M=new t.Cartesian3,S=new t.Cartesian2,B=new t.Cartesian2,k=new t.Cartesian3,z=new i.Quaternion,W=new i.Matrix3,Y=new i.Matrix3;function U(r){var o,n=r.vertexFormat,l=r.geometry,u=r.shadowVolume,c=l.attributes.position.values,y=c.length,m=r.wall,d=r.top||m,h=r.bottom||m;if(n.st||n.normal||n.tangent||n.bitangent||u){var f=r.boundingRectangle,b=r.tangentPlane,_=r.ellipsoid,v=r.stRotation,P=r.perPositionHeight,C=S;C.x=f.x,C.y=f.y;var w,x=n.st?new Float32Array(y/3*2):void 0;n.normal&&(w=P&&d&&!m?l.attributes.normal.values:new Float32Array(y));var T,I=n.tangent?new Float32Array(y):void 0,G=n.bitangent?new Float32Array(y):void 0,U=u?new Float32Array(y):void 0,j=0,Q=0,q=V,K=F,Z=D,J=!0,X=W,$=Y;$=0!==v?(T=i.Quaternion.fromAxisAngle(b._plane.normal,v,z),X=i.Matrix3.fromQuaternion(T,X),T=i.Quaternion.fromAxisAngle(b._plane.normal,-v,z),i.Matrix3.fromQuaternion(T,$)):(X=i.Matrix3.clone(i.Matrix3.IDENTITY,X),i.Matrix3.clone(i.Matrix3.IDENTITY,$));var ee=0,te=0;d&&h&&(ee=y/2,te=y/3,y/=2);for(var re=0;re<y;re+=3){var ae,oe,ie,ne,se,le,ue,pe,ce=t.Cartesian3.fromArray(c,re,k);n.st&&(ae=i.Matrix3.multiplyByVector(X,ce,O),ae=_.scaleToGeodeticSurface(ae,ae),oe=b.projectPointOntoPlane(ae,B),t.Cartesian2.subtract(oe,C,oe),ie=g.CesiumMath.clamp(oe.x/f.width,0,1),ne=g.CesiumMath.clamp(oe.y/f.height,0,1),h&&(x[j+te]=ie,x[j+1+te]=ne),d&&(x[j]=ie,x[j+1]=ne),j+=2),(n.normal||n.tangent||n.bitangent||u)&&(se=Q+1,le=Q+2,m?(re+3<y&&(ue=t.Cartesian3.fromArray(c,re+3,L),J&&(pe=t.Cartesian3.fromArray(c,re+y,N),P&&(o=ce,ae=ue,oe=pe,ie=void 0,ie=(ne=_).cartesianToCartographic(o,A).height,(o=ne.cartesianToCartographic(ae,E)).height=ie,ne.cartographicToCartesian(o,ae),(ae=ne.cartesianToCartographic(oe,E)).height=ie-100,ne.cartographicToCartesian(ae,oe)),t.Cartesian3.subtract(ue,ce,ue),t.Cartesian3.subtract(pe,ce,pe),q=t.Cartesian3.normalize(t.Cartesian3.cross(pe,ue,q),q),J=!1),t.Cartesian3.equalsEpsilon(ue,ce,g.CesiumMath.EPSILON10)&&(J=!0)),(n.tangent||n.bitangent)&&(Z=_.geodeticSurfaceNormal(ce,Z),n.tangent&&(K=t.Cartesian3.normalize(t.Cartesian3.cross(Z,q,K),K)))):(q=_.geodeticSurfaceNormal(ce,q),(n.tangent||n.bitangent)&&(P&&(H=t.Cartesian3.fromArray(w,Q,H),R=t.Cartesian3.cross(t.Cartesian3.UNIT_Z,H,R),R=t.Cartesian3.normalize(i.Matrix3.multiplyByVector($,R,R),R),n.bitangent&&(M=t.Cartesian3.normalize(t.Cartesian3.cross(H,R,M),M))),K=t.Cartesian3.cross(t.Cartesian3.UNIT_Z,q,K),K=t.Cartesian3.normalize(i.Matrix3.multiplyByVector($,K,K),K),n.bitangent&&(Z=t.Cartesian3.normalize(t.Cartesian3.cross(q,K,Z),Z)))),n.normal&&(r.wall?(w[Q+ee]=q.x,w[se+ee]=q.y,w[le+ee]=q.z):h&&(w[Q+ee]=-q.x,w[se+ee]=-q.y,w[le+ee]=-q.z),(d&&!P||m)&&(w[Q]=q.x,w[se]=q.y,w[le]=q.z)),u&&(m&&(q=_.geodeticSurfaceNormal(ce,q)),U[Q+ee]=-q.x,U[se+ee]=-q.y,U[le+ee]=-q.z),n.tangent&&(r.wall?(I[Q+ee]=K.x,I[se+ee]=K.y,I[le+ee]=K.z):h&&(I[Q+ee]=-K.x,I[se+ee]=-K.y,I[le+ee]=-K.z),d&&(P?(I[Q]=R.x,I[se]=R.y,I[le]=R.z):(I[Q]=K.x,I[se]=K.y,I[le]=K.z))),n.bitangent&&(h&&(G[Q+ee]=Z.x,G[se+ee]=Z.y,G[le+ee]=Z.z),d&&(P?(G[Q]=M.x,G[se]=M.y,G[le]=M.z):(G[Q]=Z.x,G[se]=Z.y,G[le]=Z.z))),Q+=3)}n.st&&(l.attributes.st=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:x})),n.normal&&(l.attributes.normal=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),n.tangent&&(l.attributes.tangent=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),n.bitangent&&(l.attributes.bitangent=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),u&&(l.attributes.extrudeDirection=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U}))}return r.extrude&&e.defined(r.offsetAttribute)&&(v=c.length/3,T=new Uint8Array(v),r.offsetAttribute===a.GeometryOffsetAttribute.TOP?d&&h||m?T=a.arrayFill(T,1,0,v/2):d&&(T=a.arrayFill(T,1)):(v=r.offsetAttribute===a.GeometryOffsetAttribute.NONE?0:1,T=a.arrayFill(T,v)),l.attributes.applyOffset=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})),l}var j=new t.Cartographic,Q=new t.Cartographic,q={westOverIDL:0,eastOverIDL:0},K=new l.EllipsoidGeodesic;function Z(a,o,i,n,s){if(s=e.defaultValue(s,new t.Rectangle),!e.defined(a)||a.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(i===r.ArcType.RHUMB)return t.Rectangle.fromCartesianArray(a,o,s);K.ellipsoid.equals(o)||(K=new l.EllipsoidGeodesic(void 0,void 0,o)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,q.westOverIDL=Number.POSITIVE_INFINITY,q.eastOverIDL=Number.NEGATIVE_INFINITY;for(var u,p=1/g.CesiumMath.chordLength(n,o.maximumRadius),c=a.length,y=o.cartesianToCartographic(a[0],Q),m=j,d=1;d<c;d++)u=m,m=y,y=o.cartesianToCartographic(a[d],u),K.setEndPoints(m,y),X(K,p,s,q);return u=m,m=y,y=o.cartesianToCartographic(a[0],u),K.setEndPoints(m,y),X(K,p,s,q),s.east-s.west>q.eastOverIDL-q.westOverIDL&&(s.west=q.westOverIDL,s.east=q.eastOverIDL,s.east>g.CesiumMath.PI&&(s.east=s.east-g.CesiumMath.TWO_PI),s.west>g.CesiumMath.PI&&(s.west=s.west-g.CesiumMath.TWO_PI)),s}var J=new t.Cartographic;function X(e,t,r,a){for(var o=e.surfaceDistance,i=Math.ceil(o*t),n=0<i?o/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,J);s+=n;var p=u.longitude;u=u.latitude,r.west=Math.min(r.west,p),r.east=Math.max(r.east,p),r.south=Math.min(r.south,u),r.north=Math.max(r.north,u),p=0<=p?p:p+g.CesiumMath.TWO_PI,a.westOverIDL=Math.min(a.westOverIDL,p),a.eastOverIDL=Math.max(a.eastOverIDL,p)}}var $=[];function ee(a){var o,i=a.polygonHierarchy,n=e.defaultValue(a.vertexFormat,f.VertexFormat.DEFAULT),s=e.defaultValue(a.ellipsoid,t.Ellipsoid.WGS84),l=e.defaultValue(a.granularity,g.CesiumMath.RADIANS_PER_DEGREE),u=e.defaultValue(a.stRotation,0),p=e.defaultValue(a.perPositionHeight,!1),c=p&&e.defined(a.extrudedHeight),y=e.defaultValue(a.height,0),m=e.defaultValue(a.extrudedHeight,y);c||(o=Math.max(y,m),m=Math.min(y,m),y=o),this._vertexFormat=f.VertexFormat.clone(n),this._ellipsoid=t.Ellipsoid.clone(s),this._granularity=l,this._stRotation=u,this._height=y,this._extrudedHeight=m,this._closeTop=e.defaultValue(a.closeTop,!0),this._closeBottom=e.defaultValue(a.closeBottom,!0),this._polygonHierarchy=i,this._perPositionHeight=p,this._perPositionHeightExtrude=c,this._shadowVolume=e.defaultValue(a.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=a.offsetAttribute,this._arcType=e.defaultValue(a.arcType,r.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=d.PolygonGeometryLibrary.computeHierarchyPackedLength(i)+t.Ellipsoid.packedLength+f.VertexFormat.packedLength+12}ee.fromPositions=function(t){return new ee({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,closeTop:t.closeTop,closeBottom:t.closeBottom,offsetAttribute:t.offsetAttribute,arcType:t.arcType})},ee.pack=function(r,a,o){return o=e.defaultValue(o,0),o=d.PolygonGeometryLibrary.packPolygonHierarchy(r._polygonHierarchy,a,o),t.Ellipsoid.pack(r._ellipsoid,a,o),o+=t.Ellipsoid.packedLength,f.VertexFormat.pack(r._vertexFormat,a,o),o+=f.VertexFormat.packedLength,a[o++]=r._height,a[o++]=r._extrudedHeight,a[o++]=r._granularity,a[o++]=r._stRotation,a[o++]=r._perPositionHeightExtrude?1:0,a[o++]=r._perPositionHeight?1:0,a[o++]=r._closeTop?1:0,a[o++]=r._closeBottom?1:0,a[o++]=r._shadowVolume?1:0,a[o++]=e.defaultValue(r._offsetAttribute,-1),a[o++]=r._arcType,a[o]=r.packedLength,a};var te=t.Ellipsoid.clone(t.Ellipsoid.UNIT_SPHERE),re=new f.VertexFormat,ae={polygonHierarchy:{}};return ee.unpack=function(r,a,o){a=e.defaultValue(a,0);var i=d.PolygonGeometryLibrary.unpackPolygonHierarchy(r,a);a=i.startingIndex,delete i.startingIndex;var n=t.Ellipsoid.unpack(r,a,te);a+=t.Ellipsoid.packedLength;var s=f.VertexFormat.unpack(r,a,re);a+=f.VertexFormat.packedLength;var l=r[a++],u=r[a++],p=r[a++],c=r[a++],y=1===r[a++],m=1===r[a++],g=1===r[a++],h=1===r[a++],b=1===r[a++],_=r[a++],v=r[a++];return a=r[a],(o=e.defined(o)?o:new ee(ae))._polygonHierarchy=i,o._ellipsoid=t.Ellipsoid.clone(n,o._ellipsoid),o._vertexFormat=f.VertexFormat.clone(s,o._vertexFormat),o._height=l,o._extrudedHeight=u,o._granularity=p,o._stRotation=c,o._perPositionHeightExtrude=y,o._perPositionHeight=m,o._closeTop=g,o._closeBottom=h,o._shadowVolume=b,o._offsetAttribute=-1===_?void 0:_,o._arcType=v,o.packedLength=a,o},ee.computeRectangle=function(a,o){var i=e.defaultValue(a.granularity,g.CesiumMath.RADIANS_PER_DEGREE),n=e.defaultValue(a.arcType,r.ArcType.GEODESIC),s=a.polygonHierarchy;return a=e.defaultValue(a.ellipsoid,t.Ellipsoid.WGS84),Z(s.positions,a,n,i,o)},ee.createGeometry=function(t){var r=t._vertexFormat,o=t._ellipsoid,n=t._granularity,l=t._stRotation,f=t._polygonHierarchy,b=t._perPositionHeight,_=t._closeTop,v=t._closeBottom,P=t._arcType;if(!((I=f.positions).length<3)){var C=u.EllipsoidTangentPlane.fromPoints(I,o),w=(f=d.PolygonGeometryLibrary.polygonsFromHierarchy(f,C.projectPointsOntoPlane.bind(C),!b,o)).hierarchy,x=f.polygons;if(0!==w.length){var T,I=w[0].outerRing,A=(I=d.PolygonGeometryLibrary.computeBoundingRectangle(C.plane.normal,C.projectPointOntoPlane.bind(C),I,l,G),[]),E=t._height,O=t._extrudedHeight,V={perPositionHeight:b,vertexFormat:r,geometry:void 0,tangentPlane:C,boundingRectangle:I,ellipsoid:o,stRotation:l,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:P};if(t._perPositionHeightExtrude||!g.CesiumMath.equalsEpsilon(E,O,0,g.CesiumMath.EPSILON2))for(V.extrude=!0,V.top=_,V.bottom=v,V.shadowVolume=t._shadowVolume,V.offsetAttribute=t._offsetAttribute,T=0;T<x.length;T++){var F,D=function(e,t,r,a,o,i,n,s,l){var p={walls:[]};if(i||n){t=(x=d.PolygonGeometryLibrary.createGeometryFromPositions(e,t,r,o,s,l)).attributes.position.values;var y=x.indices;if(i&&n){var g,f=(i=t.concat(t)).length/3;(g=m.IndexDatatype.createTypedArray(f,2*y.length)).set(y);for(var b=y.length,_=f/2,v=0;v<b;v+=3){var P=g[v]+_,C=g[v+1]+_,w=g[v+2]+_;g[v+b]=w,g[v+1+b]=C,g[v+2+b]=P}x.attributes.position.values=i,o&&s.normal&&(s=x.attributes.normal.values,x.attributes.normal.values=new Float32Array(i.length),x.attributes.normal.values.set(s)),x.indices=g}else if(n){for(f=t.length/3,g=m.IndexDatatype.createTypedArray(f,y.length),v=0;v<y.length;v+=3)g[v]=y[v+2],g[v+1]=y[v+1],g[v+2]=y[v];x.indices=g}p.topAndBottom=new c.GeometryInstance({geometry:x})}var x=a.outerRing,T=u.EllipsoidTangentPlane.fromPoints(x,e).projectPointsOntoPlane(x,$);h.PolygonPipeline.computeWindingOrder2D(T)===h.WindingOrder.CLOCKWISE&&(x=x.slice().reverse());var I=d.PolygonGeometryLibrary.computeWallGeometry(x,e,r,o,l);p.walls.push(new c.GeometryInstance({geometry:I}));var A=a.holes;for(v=0;v<A.length;v++){var E=A[v];T=u.EllipsoidTangentPlane.fromPoints(E,e).projectPointsOntoPlane(E,$),h.PolygonPipeline.computeWindingOrder2D(T)===h.WindingOrder.COUNTER_CLOCKWISE&&(E=E.slice().reverse()),I=d.PolygonGeometryLibrary.computeWallGeometry(E,e,r,o,l),p.walls.push(new c.GeometryInstance({geometry:I}))}return p}(o,x[T],n,w[T],b,_,v,r,P);_&&v?(F=D.topAndBottom,V.geometry=d.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(F.geometry,E,O,o,b)):_?((F=D.topAndBottom).geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,E,o,!b),V.geometry=F.geometry):v&&((F=D.topAndBottom).geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,O,o,!0),V.geometry=F.geometry),(_||v)&&(V.wall=!1,F.geometry=U(V),A.push(F));var L=D.walls;V.wall=!0;for(var N=0;N<L.length;N++){var H=L[N];V.geometry=d.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(H.geometry,E,O,o,b),H.geometry=U(V),A.push(H)}}else for(T=0;T<x.length;T++){var R,M,S=new c.GeometryInstance({geometry:d.PolygonGeometryLibrary.createGeometryFromPositions(o,x[T],n,b,r,P)});S.geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(S.geometry.attributes.position.values,E,o,!b),V.geometry=S.geometry,S.geometry=U(V),e.defined(t._offsetAttribute)&&(M=S.geometry.attributes.position.values.length,R=new Uint8Array(M/3),M=t._offsetAttribute===a.GeometryOffsetAttribute.NONE?0:1,a.arrayFill(R,M),S.geometry.attributes.applyOffset=new p.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:R})),A.push(S)}return(C=y.GeometryPipeline.combineInstances(A)[0]).attributes.position.values=new Float64Array(C.attributes.position.values),C.indices=m.IndexDatatype.createTypedArray(C.attributes.position.values.length/3,C.indices),I=C.attributes,l=i.BoundingSphere.fromVertices(I.position.values),r.position||delete I.position,new p.Geometry({attributes:I,indices:C.indices,primitiveType:C.primitiveType,boundingSphere:l,offsetAttribute:t._offsetAttribute})}}},ee.createShadowVolume=function(e,t,r){var a=e._granularity,o=e._ellipsoid;return t=t(a,o),r=r(a,o),new ee({polygonHierarchy:e._polygonHierarchy,ellipsoid:o,stRotation:e._stRotation,granularity:a,perPositionHeight:!1,extrudedHeight:t,height:r,vertexFormat:f.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(ee.prototype,{rectangle:{get:function(){var t;return e.defined(this._rectangle)||(t=this._polygonHierarchy.positions,this._rectangle=Z(t,this._ellipsoid,this._arcType,this._granularity)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0==t)return[0,0,0,1,1,0];var r=e._ellipsoid,a=e._polygonHierarchy.positions;return e=e.rectangle,p.Geometry._textureCoordinateRotationPoints(a,t,r,e)}(this)),this._textureCoordinateRotationPoints}}}),function(r,a){return(r=e.defined(a)?ee.unpack(r,a):r)._ellipsoid=t.Ellipsoid.clone(r._ellipsoid),ee.createGeometry(r)}}));
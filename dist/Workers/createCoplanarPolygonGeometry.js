define(["./arrayRemoveDuplicates-3fea1e5f","./BoundingRectangle-07202124","./Transforms-79117a7b","./Cartesian2-8646c5a1","./Check-24483042","./ComponentDatatype-1a100acd","./CoplanarPolygonGeometryLibrary-32520d7a","./when-54335d57","./GeometryAttribute-374f805d","./GeometryAttributes-caa08d6c","./GeometryInstance-6aa9010a","./GeometryPipeline-571ff4c9","./IndexDatatype-82ceea78","./Math-d6182036","./PolygonGeometryLibrary-2a7648d9","./PolygonPipeline-97a7160d","./VertexFormat-81ec7207","./RuntimeError-88a32665","./WebGLConstants-95ceb4e9","./OrientedBoundingBox-eb360dc3","./EllipsoidTangentPlane-325a8e68","./IntersectionTests-5394f658","./Plane-13ae4b1b","./AttributeCompression-10c27d9c","./EncodedCartesian3-bf827957","./ArcType-2b58731c","./EllipsoidRhumbLine-2b7999f3"],(function(e,t,a,n,r,o,i,l,s,p,y,c,m,u,d,g,h,b,C,v,f,x,P,w,A,F,G){"use strict";var L=new n.Cartesian3,E=new t.BoundingRectangle,T=new n.Cartesian2,D=new n.Cartesian2,_=new n.Cartesian3,k=new n.Cartesian3,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,H=new a.Quaternion,B=new a.Matrix3,O=new a.Matrix3,z=new n.Cartesian3;function S(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=l.defaultValue(e.vertexFormat,h.VertexFormat.DEFAULT);this._vertexFormat=h.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(l.defaultValue(e.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=d.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+h.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}S.fromPositions=function(e){return new S({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},S.pack=function(e,t,a){return a=l.defaultValue(a,0),a=d.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),n.Ellipsoid.pack(e._ellipsoid,t,a),a+=n.Ellipsoid.packedLength,h.VertexFormat.pack(e._vertexFormat,t,a),a+=h.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var N=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),Q=new h.VertexFormat,j={polygonHierarchy:{}};return S.unpack=function(e,t,a){t=l.defaultValue(t,0);var r=d.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=n.Ellipsoid.unpack(e,t,N);t+=n.Ellipsoid.packedLength;var i=h.VertexFormat.unpack(e,t,Q);t+=h.VertexFormat.packedLength;var s=e[t++];return t=e[t],(a=l.defined(a)?a:new S(j))._polygonHierarchy=r,a._ellipsoid=n.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=h.VertexFormat.clone(i,a._vertexFormat),a._stRotation=s,a.packedLength=t,a},S.createGeometry=function(t){var r=t._vertexFormat,l=t._polygonHierarchy,h=t._stRotation,b=l.positions;if(!((b=e.arrayRemoveDuplicates(b,n.Cartesian3.equalsEpsilon,!0)).length<3)){var C=_,v=k,f=V,x=I,P=M;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(b,R,x,P)){C=n.Cartesian3.cross(x,P,C),C=n.Cartesian3.normalize(C,C),n.Cartesian3.equalsEpsilon(R,n.Cartesian3.ZERO,u.CesiumMath.EPSILON6)||(w=t._ellipsoid.geodeticSurfaceNormal(R,z),n.Cartesian3.dot(C,w)<0&&(C=n.Cartesian3.negate(C,C),x=n.Cartesian3.negate(x,x)));var w=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(R,x,P),A=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(R,x,P);r.tangent&&(v=n.Cartesian3.clone(x,v)),r.bitangent&&(f=n.Cartesian3.clone(P,f)),w=(l=d.PolygonGeometryLibrary.polygonsFromHierarchy(l,w,!1)).hierarchy;var F=l.polygons;if(0!==w.length){b=w[0].outerRing,l=a.BoundingSphere.fromPoints(b);for(var G=d.PolygonGeometryLibrary.computeBoundingRectangle(C,A,b,h,E),S=[],N=0;N<F.length;N++){var Q=new y.GeometryInstance({geometry:function(e,t,r,i,l,y,c,d){var h=e.positions,b=g.PolygonPipeline.triangulate(e.positions2D,e.holes);b.length<3&&(b=[0,1,2]),(e=m.IndexDatatype.createTypedArray(h.length,b.length)).set(b);var C=B;0!==i?(b=a.Quaternion.fromAxisAngle(y,i,H),C=a.Matrix3.fromQuaternion(b,C),(t.tangent||t.bitangent)&&(b=a.Quaternion.fromAxisAngle(y,-i,H),x=a.Matrix3.fromQuaternion(b,O),c=n.Cartesian3.normalize(a.Matrix3.multiplyByVector(x,c,c),c),t.bitangent&&(d=n.Cartesian3.normalize(n.Cartesian3.cross(y,c,d),d)))):C=a.Matrix3.clone(a.Matrix3.IDENTITY,C);var v=D;t.st&&(v.x=r.x,v.y=r.y);for(var f=h.length,x=3*f,P=new Float64Array(x),w=t.normal?new Float32Array(x):void 0,A=t.tangent?new Float32Array(x):void 0,F=t.bitangent?new Float32Array(x):void 0,G=t.st?new Float32Array(2*f):void 0,E=0,_=0,k=0,V=0,R=0,I=0;I<f;I++){var M,z=h[I];P[E++]=z.x,P[E++]=z.y,P[E++]=z.z,t.st&&(M=l(a.Matrix3.multiplyByVector(C,z,L),T),n.Cartesian2.subtract(M,v,M),z=u.CesiumMath.clamp(M.x/r.width,0,1),M=u.CesiumMath.clamp(M.y/r.height,0,1),G[R++]=z,G[R++]=M),t.normal&&(w[_++]=y.x,w[_++]=y.y,w[_++]=y.z),t.tangent&&(A[V++]=c.x,A[V++]=c.y,A[V++]=c.z),t.bitangent&&(F[k++]=d.x,F[k++]=d.y,F[k++]=d.z)}return x=new p.GeometryAttributes,t.position&&(x.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:P})),t.normal&&(x.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.tangent&&(x.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),t.bitangent&&(x.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.st&&(x.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:G})),new s.Geometry({attributes:x,indices:e,primitiveType:s.PrimitiveType.TRIANGLES})}(F[N],r,G,h,A,C,v,f)});S.push(Q)}return(w=c.GeometryPipeline.combineInstances(S)[0]).attributes.position.values=new Float64Array(w.attributes.position.values),w.indices=m.IndexDatatype.createTypedArray(w.attributes.position.values.length/3,w.indices),b=w.attributes,r.position||delete b.position,new s.Geometry({attributes:b,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:l})}}}},function(e,t){return l.defined(t)&&(e=S.unpack(e,t)),S.createGeometry(e)}}));